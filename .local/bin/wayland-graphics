#!/bin/sh
# Environment variables to use different graphics card

cmd_out="$HOME/.cache/script-cache/graphics"
opt=$(printf "NVIDIA\nAMD\nNouveau" | mew -p "Select graphics:" -i) || exit 1

case "$opt" in
  "NVIDIA")
    cat <<EOF > $cmd_out
#!/bin/sh
# NVIDIA
card=/dev/dri/card1
[ -e "\$card" ] || card=/dev/dri/card0
export WLR_RENDERER=vulkan
export WLR_DRM_DEVICES="\$card"
export GBM_BACKEND=nvidia-drm
sudo modprobe -r nouveau
sudo modprobe nvidia_drm nvidia_modeset nvidia_uvm nvidia
EOF
    ;;
  "AMD")
cat <<EOF > $cmd_out
#!/bin/sh
# AMD
export WLR_RENDERER=gles2
export WLR_DRM_DEVICES=/dev/dri/card2
sudo modprobe -r nouveau
sudo modprobe -r nvidia_drm nvidia_modeset nvidia_uvm nvidia
EOF
    ;;
  "Nouveau")
cat <<EOF > $cmd_out
#!/bin/sh
# Nouveau
#sudo modprobe -r nvidia_drm nvidia_modeset nvidia_uvm nvidia
#sudo modprobe nouveau
EOF
    ;;
  *) exit 1 ;;
esac

notify-send -t 5000 "Graphics changed!" "<span color='#85AEF1'>$opt</span>\
 will be used in the next session!"
